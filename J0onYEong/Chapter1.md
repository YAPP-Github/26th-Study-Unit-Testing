# 요약

단위테스트는 단순히 테스트 코드를 작성하는 것보다 더 큰 범주의 주제이다.

단위테스트에 시간을 투자할 때 항상 최대한 이득을 얻도록 노력해야 하며, 테스트에 드는 노력을 가능한 줄이고 그3로인한 이득을 최대화 하는 것에 주목해야한다.

## 단위 테스트 현황

단위테스트는 작성하는 것에 의의를 두기보단, **노력 대비 최대의 이익을 끌어내는 것**이 진짜 중요한 포인트이다.

## 단위 테스트의 목표

단위테스트의 궁극적인 목표는 소프트웨어 프로젝트의 지속 가능한 성장을 가능하게 하는 것이다.

단위테스트가 없는 코드는 프로젝트 초기 결점이 적어 빠르게 기능을 개발하며 폭발적으로 진척도가 올라가는 장점이 있다. 하지만 시간이 지나면서 점점 더 많은 작업시간이 필요하게된다.

개발 속도가 빠르게 감소하는 이러한 형상을 소프트웨어 엔트로피라고한다.

소프트웨어의 엔트로피는 품질을 떨어트리는 코드의 형태로 나타나게된다.

지속적인 코드 정리와 리팩토링을 하지 않으면 시스템은 점점 더 복잡해지고 무질서 해진다.

테스트는 소프트웨어 엔트로피를 줄일 수 있다.

테스트 코드가 작성된 프로젝트는 새로운 기능이나 요구사항에 더 잘 맞게 **리팩토링한 후에도 기존 기능이 잘 작동하는지 확인**하는데 큰 도움이된다.

테스트 시스템이 있는 프로젝트의 단점은 초반에 노력이 많이 필요하드는 것이다.

## 좋은 테스트와 그렇지 않은 테스트

단순히 단위테스트를 작성만 하는 것은 여전히 소프트웨어 엔트로피를 효과적으로 제어하지 못한다.

중요한 것은 프로젝트의 도움이 되는 테스트 코드르 작성하는 것이다. 테스트 코드도 코드의 일부로 그 양이 많아지면 일반 코드와 같인 관리가 필요하고 이는 결국 비용문제로 연결되기 때문이다.

**코드는 자산이 아니라 책임이다. 가능한 적은 코드로 문제를 해결하는 것이 가장 좋다. (=효율이 높은 코드가 중요하다)**

## 테스트 스위트 품질 측정

커버리지 지표는 테스트 스위트가 소스 코드를 얼마나 실행하는지를 백분율로 나타낸 것이다.

※ 테스트 스위트란 관련된 테스트 케이들의 집합을 의미한다. 예를들어 A메서드에 대한 테스트를 진행할 때 여러 테스트 케이스 함수들이 하나의 스위트로 분류된다.

코드 버러리지 수치가 낮다면 테스트가 충분하지 않다는 좋은 증거로 사용될 수 있다. 하지만 **그 수치가 높다고 반드시 양질의 테스트 스위트임을 보장할 수 없다는 것이 핵심**이다.

### 코드 커버리지(테스트 커버리지)

$코드 커버리지 수치 = \frac{(테스트 코드 라인수)}{(테스트하는 기능의 전체 라인 수)}$

해당 지표는 식에알 수 있듯이 실제 코드에 대비해서 얼마나 많은 테스트 코드가 작성되어 있는지 알 수 있는 지표이다. 

해당 값이 너무 낮으면 실제 코드에 비해 테스트 코드작성량이 적다고는 판단할 수 있다.

하지만, 코드 라인수는 프로그래머의 역량에 따라 같은 로직이지만 손쉽게 축약할 수 있다. 따라서 동일한 기능에 대해 아무런 품질 향상 없이 수치를 증가시킬 수 있음으로 품지여부를 판단하는 기준이 될 수는 없다.

### 분기 커버리지

$분기 커버리지 수치 = \frac{(테스트 하는 케이스)}{(전체 경우의 수)}$

예를들어 문자열의 길이가 긴지 짧은지 판단하는 코드가 있다고 해보자, 이 때 해당 기능의 아웃풋은 “길다” 혹은 “짧다”로 전체 분기에 대한 경우의 수가 2이다.

만약 짧은 경우에 대한 테스트코드만 작성한다면, 분기 커버리지 수치는 50%가 되는 것이다.

분기 커버리지의 한계는 다음과 같다.

- **가능한 모든 결과를 검증할 수 없음**
    
    단위 테스트는 특정 기능을 테스트할 때 반드시 해당 기능이 유발하는 모든 결과에 대한 검증이 진행됬을 때 의미를 가진다.
    
    예를들어 앞의 예제에서 마지막으로 길었던 문장을 따로 저장하는 기능이 추가된다고 해보자. 즉, 함수 실행마다 상태가 업데이트는 새로운 결과가 발생한다. 문제점은 새롭게 추가된 코드에 대해 어떠한 검증 로직을 추가하지 않아도 분기커버리지 수치는 변하지 않는다는 것이다.
    

- **꼼수를 만들 수 있다.**
    
    경우의 수에 대한 테스트 코드를 작성하지만, 검증로직을 포함하지 않아도 그 수치가 유지된다.
    

- **외부 라이브러리 코드를 고려할 수 없다.(숨어있는 분기)**
    
    외부라이브러리 로직을 포함하는 경우 해당 라이브러리가 반환하는 결과에 대한 경우의수를 파악하기 쉽지않다.(구현 코드 미공개일 경우 더더욱) 따라서 믿을 수 있는 수치로 판별하기 어렵다.
    

결론적으로 코드커버리지와 분기 커버리지로는 단위 테스트의 품질을 분명하게 나타낼 수 없다.

## 무엇이 성공적인 테스트 스위트를 만드는가?

테스트 스위트가 얼마나 좋은지 자동을 확인할 수 없다는 것이 결론이다. 개인의 판단에 맡겨야 한다.

성공적인 테스트 스위트는 다음과 같은 특성을 가진다.

### 테스트 스위트가 개발주기에 통합돼어 있다.

- 자동화된 테스트를 할 수 있는 방법은 끊임없이 하는 것 뿐이다.
- 모든 테스트는 개발 주기에 통합돼야 한다.
- 코드가 변경될 때 한개이상의 테스트 코드는 반드시 실행되야한다.

### 코드베이스에서 가장 중요한 부분만을 대상으로 한다.

가장 중요한 부분만을 검증하는 것이 중요하다. 흔히 도메인 로직이라고 불린다.

주요한 전제는 서비스에 중요한 부분과 중요한 부분을 코드레벨에서 명확하게 분리하는 것이다.

이러한 구조가 확립된 상태에서, 도메인 로직에 대한 테스트가 진행되야 한다.

### 최소 유지비로 최대 가치

테스트 코드의 가치가 유지비를 상회하는 것이 중요하다. 아래 2가지를 통해 이것을 이룰 수 있다.

- 가치 있는 테스트 식별하기
    - 판단을 위한 기준틀이 마련되야 한다.
- 가치 있는 테스트 작성하기
    - 좋은 설계가 선행되야 한다.

# 느낀점

단순히 단위 테스트를 많이 작성하면 좋다는 생각은 버려야할 것 같다는 생각을 했다.

단위 테스트 역시 코드로, 그 양이 많아질 수록 관리에 드는 비용이 증가한다는 부분이 인상적이였다.

중요한 것은 작성 비용, 유지 비용을 고려했을 때 최대 효과를 낼 수 있는 효율성이다. 이를 위해선 가치있는 테스트를 식별하기 위한 기준틀과 좋은 설계가 수반되어야함을 알 수 있었다.

이후 장에서는 해당 부분을 잘하기위한 방법들에 조금 더 주목하려고 한다.