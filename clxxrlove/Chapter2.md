## 유닛 테스트는 무엇인가 ?

이번 장에서는 간단하게 유닛 테스트가 무엇인지를 살펴봅니다.

유닛 테스트는 만족해야 하는 세 가지의 핵심 조건이 있는데요,

1. 작은 코드 단위(=unit)를 검증한다.
2. 빠르게 실행되어야 한다.
3. 고립된 환경에서 실행된다.

그럼 작은 코드 단위인 유닛은 무엇을 말할까요 ? 어떠한 스코프 범위가 될텐데, 해석에 따라 다릅니다. 메소드가 될 수도 있고, 클래스가 될 수도 있습니다.

그리고, 고립된 환경에서 실행되어야 한다는 의미는 테스트 대상과 외부 요소 간의 간섭이 없어야 한다는 것이죠. 

예를 들어 데이터베이스에서 데이터를 받아와 가공하는 객체가 있다고 해보겠습니다. 이 객체의 주된 역할은 받아온 데이터를 가공하는 것입니다.

여기서 데이터베이스의 상태가 중요할까요 ? 아닙니다. 이 테스트는 데이터베이스건 아니건 **데이터만 받아올 수 있으면** 테스트가 가능합니다. 그래서 이 부분은 고립되어야만 하죠.

### 두 학파의 관점 차이: 런던 vs 클래식

위에서 말한 고립된 환경이라는 것은 사실, 학파에 따라 관점이 다릅니다. 그 외에도 여러 부분에서 조금씩 다른 부분이 있습니다.

**고립해야 하는 대상에서의 관점 차이:**

런던 학파는 sut을 협력 객체로부터 격리해야 한다고 주장하며, 클래식 학파는 테스트 간 영향이 없도록 격리해야 한다고 주장합니다.

**작은 코드 단위에 대한 관점 차이:**

런던 학파는 클래스 하나를 유닛으로 봅니다. 클래식 학파는 클래스가 될 수도 있지만, 여러 클래스가 될 수도 있습니다. 즉, 클래식 학파는 하나의 기능 단위를 말합니다.

**Test Double을 사용하는 기준에 대한 관점 차이:**

런던 학파는 모든 변경 가능한 의존성에 대해서 사용해야 한다고 합니다. 클래식 학파는 공유 의존성에 한정해서 사용해야 한다고 합니다.

이외에도, 테스트 목적이나 통합 테스트를 논하는 기준이 조금씩 다릅니다. 테스트 목적의 경우 런던 학파는 클래스 간의 상호작용, 클래식 학파는 행위 단위를 관찰하고 검증해야 하는 것을 말합니다.

### 고립성에 대한 두 학파의 해석 차이

위에서 간단하게 보았지만, 보다 더 심오한 문제입니다.

런던 학파는 협력 객체를 대부분 mock 또는 stub으로 대체하는데요, 이를 통해 테스트 대상인 클래스가 올바른 메소드를 호출했는가에 집중합니다. 그래서 보통 클래스 단위로 테스트를 작성하게 되죠.

장점으로는, 테스트 구조가 명확하고 문제를 추적하기 용이합니다. 단, mock을 너무 남용한다는 단점도 있죠. 그렇기에 over-specification이라는 문제가 발생합니다. 그리고, 설계의 결함이 쉽게 가려진다는 문제도 있습니다.

그럼 클래식 학파는 어떨까요 ? 테스트 간의 간섭을 줄인다는 목적성이 뚜렷합니다. 그래서 협력 객체를 실제 객체를 사용하기도 합니다. 공유 의존성과 같은 경우에만 mock을 사용하는 방식으로요.

테스트는 코드의 상태 변화나 결과를 관찰하며 검증하는 방식이므로, 꼭 클래스 하나가 대상이 아닐 수 있습니다. 하나의 비즈니스 로직 단위로 테스트가 작성이 가능하죠.

장점으로는, 실제 동작 기반으로 테스트를 하기에 런던 학파의 단점이었던 설계 결함을 쉽게 드러냅니다. 또한 비즈니스 도메인과 더 밀접한 테스트가 가능하죠.

하지만, 이런 식의 테스트는 복잡합니다. 난이도가 조금 높다는 문제가 있죠. 그러므로 실패 원인이 명확하게 드러나지 않는 경우도 존재합니다.

### 두 학파에 대한 저자의 의견

저자는 클래식 학파를 지지(?)한다고 볼 수 있습니다. 런던 학파도 물론 장점은 있습니다. 하지만, 정말로 발생하는 문제를 가릴 수 있다는 부분은 매우 큰 단점으로 다가오죠.

그렇기에 저자는 테스트를 통해 실제 결함을 드러낼 수 있는 클래식 학파를 더 선호합니다.

## 유닛 테스트 vs 통합 테스트

다음은 통합 테스트를 간단하게 알아보겠습니다.

**테스트 목적의 차이(검증 대상):**

유닛 테스트는 학파에 상관 없이 결국 작은 단위를 테스트했습니다. 반면에 통합 테스트는 여러가지 행위 또는 시스템 간 통합에서의 테스트를 진행합니다. 목적이 크게 다릅니다.

**성능의 차이:**

유닛 테스트는 작은 단위만을 확인하기에, 빠른 테스트가 가능하지만 통합 테스트는 통합된 로직이 실행되므로 비교적 느리죠.

**고립성에서의 차이:**

유닛 테스트는 테스트 간의 완전한 고립이 가능합니다. 단위로 쪼개놨기 떄문이죠. 단, 통합 테스트의 경우에는 공유 자원에 접근해야 할 수도 있으며 복잡하므로 완전한 고립을 만들어내기 어렵습니다.

**외부 의존성에서의 차이:**

유닛 테스트에서는 외부 의존성을 test double로 대체합니다. 실제 협력 객체를 사용하는 클래식 학파에서도, 결국 기능 단위이므로 외부 의존성과는 거리가 멀죠.

하지만 통합 테스트는 그럴 수가 없습니다. 실제 데이터베이스 등 외부 의존성을 사용하여 확실하게 테스트를 해야 하기에 존재할 수 있습니다.

**⭐️ E2E 테스트란 ?**

E2E 테스트는 가능한 모든 외부 시스템과 통합하여 최종 사용자 관점에서 진행됩니다. 통합 테스트의 하위 개념으로 볼 수 있습니다.