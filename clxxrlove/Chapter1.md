## 유닛 테스트의 목표 ?

1장에서는 유닛 테스트의 목적 뿐만 아니라 어떤 것이 나쁜 테스트이며 좋은 테스트인지를 논합니다. 저는 개인적으로 테스트 코드를 작성하는 일을 귀찮은 일로 여겨왔고, 왜 해야 하는지를 제대로 이해하지 못했습니다. 그래서 이 부분에 집중하여 읽었습니다.

테스트 코드가 어떤 것을 가져다 줄지는 알고는 있으나, 언제 테스트 코드를 작성해야 하는지, 테스트 코드를 작성할 때 어떤 전략을 취해야 하는가 등등 많은 부분에서 무지하죠.

### 결국은 또, 유지보수 때문인가 ?

객체지향을 점차 익히다 보면 자주 듣게 되는 말이 있습니다. **테스트가 불가능한 구조는 잘못된 설계**라는 이야기를 마치 진리인 것처럼 들어왔습니다. 

위의 문장은 틀린 말은 아닙니다. 하지만 정확하게 짚고 나가야겠죠. 오해할 수 있는 여지가 있습니다. **테스트가 가능한 구조로 설계하는 것이 항상 정답은 아닙니다.** 다만, 더 좋은 방향으로 설계를 유도하죠.

저자는 좋은 유닛 테스트가 설계에 좋은 영향을 줄 수는 있으나, 이는 주요 목표가 아닌 기분 좋은 사이드 이펙트라는 말을 합니다. `it’s merely a pleasant side effect.` 

결국에는 유지보수입니다.

`Sustainability and scalability are the keys.` 

저자는 소프트웨어 엔트로피라는 패러다임을 이야기합니다. 이 엔트로피는 초기에는 드러나지 않지만, 프로덕트의 규모가 커지면 커질수록 이 엔트로피는 **Regression**이라는 재앙을 몰고 온다는 것을 이야기합니다.

마치 보험을 가입하라는 영업 사원의 이야기처럼 느껴집니다. 테스트가 없을 때의 문제점을 이야기하고, 초기 비용(보험비)를 지불하여 확장 가능한 소프트웨어를 만들라고 제안하죠. 

이에 대한 근거로는, 제대로 된 테스트 코드가 존재하지 않는다면, 기능을 추가하거나 리팩토링을 함에 있어서 기존의 것들이 아직 지속 가능한지 보장할 수 없습니다. 

결국에 **regression**이 찾아왔을 때, 프로덕트를 안정화시키기 위해서는 미리 지불해야 했던 테스트 코드의 초기 비용보다 많은 비용을 지불하게 됨을 알 수 있습니다.

## 좋은 테스트와 나쁜 테스트 ?

이번 장에서는 좋은 테스트가 무엇인지는 사실 명확하지는 않습니다. 다만, 좋은 테스트처럼 보일 수 있는 함정에 대해서 이야기하죠. 그리고, 무엇이 나쁜 테스트인지도 이야기합니다.

### 나쁜 테스트의 예시들

테스트 코드도 결국에 코드베이스가 됩니다. 즉, 테스트 코드도 유지보수가 필요하단 말이죠. 기존의 코드를 변경할 때 테스트 코드가 크게 변해야 한다면 어떨까요 ? 아니면 테스트 코드의 가독성이 나쁘다면 어떨까요 ?

결국에 테스트 코드도 유지보수가 가능하도록 작성해야 합니다. 유지보수가 어려운 테스트 코드는 오히려 가치가 없어질 수도 있죠.

### Coverage metric

테스트 커버리지라는 이야기를 간혹 듣곤 합니다. 기존 코드베이스를 테스트가 얼마나 검사하는지에 대한 지표인데요. 

결론부터 말하면, **좋은 테스트가 무엇인지를 잘 모르는 상태에서** 커버리지만 신경 쓰는 것은 결코 좋은 테스트가 되지 못합니다.

### Code coverage

Coverage metric은 두 종류로 나뉩니다. Code coverage와 Branch coverage. 우선적으로 Code coverage의 단점을 이야기해보겠습니다.

아니, 우선 Coverage metric에 어떤 문제가 있는지 생각해볼까요 ?

커버리지 수치에 매몰되게 되면, **좋은 테스트를 작성하는 것**보다, 얼마나 라인을 채우는지에 급급하게 되죠.

Code coverage가 딱 그런 예시입니다. 이미 작성된 코드에서, 분기 처리를 약간 우회하여 삼항 연산자를 떡칠하는 등의 방식으로 작성하면 수치가 올라가죠. 테스트 코드가 실제로 커버하는 영역은 변하지 않았지만요.

### Branch coverage

그럼 Branch coverage는 위에서 이야기하는 우회 방법을 차단할 수 있습니다. 단순히 몇 라인을 커버했는지가 문제가 아니라 가지의 수를 확인하기 때문이죠.

삼항 연산자가 있는 그 라인도 `true`와 `false`로 두 개의 가지가 생기는데, 이 가지를 다 테스트 해야 100%가 되는거죠. Code coverage보다는 훨씬 낫습니다.

그래도 여전히 문제점은 넘쳐납니다. 예를 들어 보면 외부 의존성에 대한 가지가 생기기도 합니다. 

결국 Coverage metric은 좋은 테스트를 판가름하기에 사용하기 보다는, 나쁜 테스트를 판가름하기에 적합해 보입니다. 높은 커버리지를 가진 테스트가 항상 좋지는 않지만, 낮은 커버리지를 가지는 테스트는 항상 나쁩니다.

### 그렇다면 좋은 테스트는 무엇인가 ?

정확히 어떻게 해야 좋은 테스트인지는 아직 논하지 않았습니다. 다만, 좋은 테스트의 특징은 있죠.

개발 주기 내에 자연스럽게 통합되어 있어야 하며, 코드베이스 중 가장 중요한 부분(도메인 영역과 같은 레이어를 이야기합니다.)을 정확하게 겨냥해야 하고, 최소한의 비용으로 최대한의 가치를 제공해야 합니다.

아직은 좋은 테스트가 무엇인지는 확실하지 않지만, 나쁜 테스트가 어떤 문제를 일으키며 어떤 것들이 나쁜 테스트가 될 수 있을지는 간단하게 살펴봤습니다.